
<!DOCTYPE HTML>
<html lang="en" >
    <head>
        <title>Akkamo Lifecycle Â· GitBook</title>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.1.1">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-emphasize/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-richquotes/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="module.html" />
    
    
    <link rel="prev" href="./" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../about.html">
            
                <a href="../about.html">
            
                    
                    What is Akkamo?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="./">
            
                <a href="./">
            
                    
                    How it works?
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.3.1" data-path="lifecycle.html">
            
                <a href="lifecycle.html">
            
                    
                    Akkamo Lifecycle
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="module.html">
            
                <a href="module.html">
            
                    
                    Akkamo Module
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="context.html">
            
                <a href="context.html">
            
                    
                    Akkamo Context
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="deployment.html">
            
                <a href="deployment.html">
            
                    
                    Akkamo Deployment
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../modules/">
            
                <a href="../modules/">
            
                    
                    Core modules
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../modules/akka-module.html">
            
                <a href="../modules/akka-module.html">
            
                    
                    Akka module
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../modules/akka-http-module.html">
            
                <a href="../modules/akka-http-module.html">
            
                    
                    Akka HTTP module
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../modules/config-module.html">
            
                <a href="../modules/config-module.html">
            
                    
                    Config module
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../modules/kafka-module.html">
            
                <a href="../modules/kafka-module.html">
            
                    
                    Kafka module
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../modules/log-module.html">
            
                <a href="../modules/log-module.html">
            
                    
                    Log module
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../modules/mongo-module.html">
            
                <a href="../modules/mongo-module.html">
            
                    
                    Mongo module
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../modules/persistent-config-module.html">
            
                <a href="../modules/persistent-config-module.html">
            
                    
                    Persistent config module
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="../modules/reactivemongo-module.html">
            
                <a href="../modules/reactivemongo-module.html">
            
                    
                    ReactiveMongo module
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="../modules/webcontent-module.html">
            
                <a href="../modules/webcontent-module.html">
            
                    
                    Web content module
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../best-practices/">
            
                <a href="../best-practices/">
            
                    
                    Best practices
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../best-practices/module-config.html">
            
                <a href="../best-practices/module-config.html">
            
                    
                    Module configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../best-practices/module-dependencies.html">
            
                <a href="../best-practices/module-dependencies.html">
            
                    
                    Module dependencies
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Akkamo Lifecycle</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="akkamo-lifecycle">Akkamo Lifecycle</h1>
<p>Each <em>Akkamo</em> applications is nothing more than a set of selected modules. The<em>Akkamo</em> platform itself is the core,
which brings those modules into the life and joins them into fully working application. Before explaining the module
architecture itself, the lifecycle of the <em>Akkamo</em> application must be described in more details.</p>
<p>When <em>Akkamo</em> application starts, first step is to find all available modules at the classpath. For this purpose,
<em>Akkamo</em> uses the standard mechanism of Java,
called <a href="https://docs.oracle.com/javase/8/docs/api/java/util/ServiceLoader.html" target="_blank">Service loader</a>.
Some modules, however, may declare dependencies on other modules, i.e. dependent modules must be always initialized
before, so the correct order is calculated. Once correctly ordered, the first lifecycle stage, <em>initialization</em>,
is then performed.</p>
<h2 id="init-stage">Init stage</h2>
<p>This is the very first stage of <em>Akkamo</em> lifecycle, called right after the correct order of modules is achieved.
This is the stage where module should register its own functionality into the <em>context</em> (if necessary). In order
that a module can perform some logic in this stage, the <code>Initializable</code> interface and its method
<code>initialize(ctx: Context): Res[Context]</code> must be implemented.<br>
Actual version of <em>Akkamo</em> supports next implicit conversion to <code>Res</code> automatically:</p>
<h2 id="run-stage">Run stage</h2>
<p>After the initialization stage, when all modules are successfully initialized, this stage is executed. In order
to execute custom code in a module in this stage, the interface <code>Runnable</code> and its method <code>run(ctx: Context): Res[Context]</code>
must be implemented.</p>
<h2 id="dispose-stage">Dispose stage</h2>
<p>The first two stages, <em>Init</em> and <em>Run</em>, are performed during the application startup. This stage is performed when
the JVM gets the OS signal to stop, allowing modules to gracefully release allocated resources, close opened files,
ports, etc. In order that a module can perform some logic in this stage, the <code>Disposable</code> interface and its method
<code>dispose(ctx: Context): Res[Unit]</code> must be implemented.</p>
<h4 id="implicit-conversions">Implicit conversions</h4>
<p>Actual implementation of <em>Akkamo</em> supports several implicit conversion to <code>Res[Context]</code> or <code>Res[Unit]</code>, namely from:</p>
<ul>
<li><p><code>Context</code> :</p>
<pre><code class="lang-Scala">  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">initialize</span></span>(ctx: <span class="hljs-type">Context</span>) = {
    ...
    ctx.register(...)
  }
</code></pre>
</li>
<li><p><code>Try[Context]</code> :</p>
<pre><code class="lang-Scala">  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">initialize</span></span>(ctx: <span class="hljs-type">Context</span>) = <span class="hljs-type">Try</span> {
  ...
    ctx.register(...)
  }
</code></pre>
</li>
<li><p><code>Future[Context]</code> :</p>
<pre><code class="lang-Scala">  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">initialize</span></span>(ctx: <span class="hljs-type">Context</span>) = <span class="hljs-type">Future</span> {
  ...
    ctx.register(...)
  }
</code></pre>
</li>
</ul>
<h4 id="ordering">Ordering</h4>
<p>The modules form a dependency tree.<br>
Next simple rules works during module lifecycle management:</p>
<ul>
<li>Instances of modules are created in let say <code>random</code> order.</li>
<li>if module <strong>A</strong> depends on module <strong>B</strong> then <code>initialize</code> method of <strong>B</strong> is called before call of <code>initialize</code> on <strong>A</strong>.</li>
<li>if module <strong>A</strong> depends on module <strong>B</strong> then <code>run</code> method of <strong>A</strong> is called before call of <code>run</code> method on <strong>B</strong>.</li>
<li>if module <strong>A</strong> depends on module <strong>B</strong> then <code>dispose</code> method of <strong>A</strong> is called before call of <code>dispose</code> method on <strong>B</strong>.</li>
</ul>
<p>The rules get the possibility to have only two stages when system is initialized.<br>
For example, if an module depends on <strong>AkkaHttp</strong> module then also routes appending
works in <code>run</code> method, because &quot;run&quot; of Http module follows later.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="./" class="navigation navigation-prev " aria-label="Previous page: How it works?">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="module.html" class="navigation navigation-next " aria-label="Next page: Akkamo Module">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Akkamo Lifecycle","level":"1.3.1","depth":2,"next":{"title":"Akkamo Module","level":"1.3.2","depth":2,"path":"how-it-works/module.md","ref":"how-it-works/module.md","articles":[]},"previous":{"title":"How it works?","level":"1.3","depth":1,"path":"how-it-works/index.md","ref":"how-it-works/index.md","articles":[{"title":"Akkamo Lifecycle","level":"1.3.1","depth":2,"path":"how-it-works/lifecycle.md","ref":"how-it-works/lifecycle.md","articles":[]},{"title":"Akkamo Module","level":"1.3.2","depth":2,"path":"how-it-works/module.md","ref":"how-it-works/module.md","articles":[]},{"title":"Akkamo Context","level":"1.3.3","depth":2,"path":"how-it-works/context.md","ref":"how-it-works/context.md","articles":[]},{"title":"Akkamo Deployment","level":"1.3.4","depth":2,"path":"how-it-works/deployment.md","ref":"how-it-works/deployment.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":["emphasize","richquotes","puml"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"emphasize":{},"puml":{},"search":{},"lunr":{"maxIndexSize":1000000},"fontsettings":{"theme":"white","family":"sans","size":2},"richquotes":{},"highlight":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"language":"en","gitbook":"*"},"file":{"path":"how-it-works/lifecycle.md","mtime":"2016-11-14T12:44:27.099Z","type":"markdown"},"gitbook":{"version":"3.1.1","time":"2016-12-16T08:10:14.038Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>


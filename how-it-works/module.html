<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Akkamo Module | Akkamo Documentation</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.7">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-emphasize/plugin.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-richquotes/plugin.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="../how-it-works/context.html" />
    
    
    <link rel="prev" href="../how-it-works/lifecycle.html" />
    

        
    </head>
    <body>
        
        
    <div class="book"
        data-level="2.2"
        data-chapter-title="Akkamo Module"
        data-filepath="how-it-works/module.md"
        data-basepath=".."
        data-revision="Thu Aug 04 2016 12:43:46 GMT+0200 (CEST)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="about.html">
            
                
                    <a href="../about.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        What is Akkamo?
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2" data-path="how-it-works/index.html">
            
                
                    <a href="../how-it-works/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        How it works?
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="how-it-works/lifecycle.html">
            
                
                    <a href="../how-it-works/lifecycle.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        Akkamo Lifecycle
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="2.2" data-path="how-it-works/module.html">
            
                
                    <a href="../how-it-works/module.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        Akkamo Module
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="how-it-works/context.html">
            
                
                    <a href="../how-it-works/context.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                        Akkamo Context
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="modules/index.html">
            
                
                    <a href="../modules/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Core modules
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="modules/akka-module.html">
            
                
                    <a href="../modules/akka-module.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        Akka module
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="modules/akka-http-module.html">
            
                
                    <a href="../modules/akka-http-module.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        Akka HTTP module
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="modules/config-module.html">
            
                
                    <a href="../modules/config-module.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                        Config module
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="modules/kafka-module.html">
            
                
                    <a href="../modules/kafka-module.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.</b>
                        
                        Kafka module
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="modules/log-module.html">
            
                
                    <a href="../modules/log-module.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.5.</b>
                        
                        Log module
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="modules/mongo-module.html">
            
                
                    <a href="../modules/mongo-module.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.6.</b>
                        
                        Mongo module
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.7" data-path="modules/persistent-config-module.html">
            
                
                    <a href="../modules/persistent-config-module.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.7.</b>
                        
                        Persistent config module
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.8" data-path="modules/reactivemongo-module.html">
            
                
                    <a href="../modules/reactivemongo-module.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.8.</b>
                        
                        ReactiveMongo module
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.9" data-path="modules/webcontent-module.html">
            
                
                    <a href="../modules/webcontent-module.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.9.</b>
                        
                        Web content module
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" data-path="best-practices/index.html">
            
                
                    <a href="../best-practices/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Best practices
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="best-practices/module-config.html">
            
                
                    <a href="../best-practices/module-config.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        Module configuration
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="best-practices/module-dependencies.html">
            
                
                    <a href="../best-practices/module-dependencies.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.</b>
                        
                        Module dependencies
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >Akkamo Documentation</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="akkamo-module">Akkamo Module</h1>
<p><em>Akkamo module</em> is the cornerstone of each modular application based on this platform. Module is
nothing more than an old-good Scala class, implementing appropriate <em>traits</em> and their methods.
Each module is represented by the class implementing at least <code>eu.akkamo.Module</code> trait. For module
lookup during <em>Akkamo</em> startup, Java&apos;s
<a href="https://docs.oracle.com/javase/8/docs/api/java/util/ServiceLoader.html" target="_blank">ServiceLoader</a> mechanism
is used, therefore for each <em>Akkamo</em> module a new line with <em>fully qualified domain name</em> of
module&apos;s class must be added to the <code>eu.akkamo.Module</code> file located in the <code>META-INF/services/</code>
directory of module&apos;s JAR file.</p>
<h2 id="creating-new-akkamo-module">Creating new Akkamo module</h2>
<p>Akkamo module is nothing special but plain Scala class, implementing several traits. Each module
must implement the <code>eu.akkamo.Module</code> trait, example of the simplest possible module is below:</p>
<pre><code class="lang-scala"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyModule</span> <span class="hljs-keyword"><span class="hljs-keyword">extends</span></span> <span class="hljs-title">Module</span> {</span>

  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dependencies</span>(</span>dependencies: <span class="hljs-type">Dependency</span>): <span class="hljs-type">Dependency</span> = dependencies
}
</code></pre>
<p>Method <code>dependencies</code> needs some deeper explanation. If our module interacts with any other module
(e.g. injects its registered services), such module <strong>must</strong> be declared as our module&apos;s dependency.
This is done exactly using the <code>dependencies</code> method, using the following syntax:</p>
<pre><code class="lang-scala"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dependencies</span>(</span>dependencies: <span class="hljs-type">Dependency</span>): <span class="hljs-type">Dependency</span> =
  dependencies.&amp;&amp;[<span class="hljs-type">ModuleA</span>].&amp;&amp;[<span class="hljs-type">ModuleB</span>]
</code></pre>
<p>The above example defines the <code>ModuleA</code> and <code>ModuleB</code> modules as dependencies.</p>
<blockquote class="clearfix alert alert-warning"><strong class="fa fa-4x fa-exclamation-triangle"></strong>
<p> Please pay attention to always properly define your module dependencies. If not done
so, dependend modules may not be properly initialized during the Akkamo initialization, which may
lead to unexpected runtime errors.</p>
</blockquote>
<h2 id="module-lifecycle">Module lifecycle</h2>
<p><em>Akkamo module</em> allows to run specific application code during every
<a href="lifecycle.html">Akkamo lifecycle</a>. For every lifecycle stage, there is appropriate Scala trait, which
has to be extended and implemented in order to run code during the selected lifecycle stage. Below
is the overview of available lifecycle Scala traits.</p>
<h3 id="initialization-stage">Initialization stage</h3>
<p>In order to run application code during the <em>initialization stage</em>, the trait
<em>eu.akkamo.Initializable</em> must be extended, as in following example:</p>
<pre><code class="lang-scala"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyModule</span> <span class="hljs-keyword"><span class="hljs-keyword">extends</span></span> <span class="hljs-title">Module</span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-title">Initializable</span> {</span>
  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">initialize</span>(</span>ctx: <span class="hljs-type">Context</span>): <span class="hljs-type">Res</span>[<span class="hljs-type">Context</span>] = <span class="hljs-type">Try</span> {
    <span class="hljs-comment">// application code here</span>
  }
}
</code></pre>
<p>The <code>initialize</code> method is the called during the initialization stage of the <em>Akkamo lifecycle</em>.
This method may return <a href="http://www.scala-lang.org/api/current/index.html#scala.util.Try" target="_blank">Try</a> or
<a href="http://www.scala-lang.org/api/current/index.html#scala.concurrent.Future" target="_blank">Future</a> which is
implicitly converted into the <code>Res[Context]</code>.</p>
<blockquote class="clearfix alert alert-info"><strong class="fa fa-4x fa-info"></strong>
<p> In this lifecycle stage, you should register all your module services. Never do this in
any later stage.</p>
</blockquote>
<h3 id="run-stage">Run stage</h3>
<p>In order to run application code during the <em>run stage</em>, the trait
<em>eu.akkamo.Runnable</em> must be extended, as in following example:</p>
<pre><code class="lang-scala"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyModule</span> <span class="hljs-keyword"><span class="hljs-keyword">extends</span></span> <span class="hljs-title">Module</span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-title">Runnable</span> {</span>
  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span>(</span>ctx: <span class="hljs-type">Context</span>): <span class="hljs-type">Res</span>[<span class="hljs-type">Context</span>] = <span class="hljs-type">Try</span> {
    <span class="hljs-comment">// application code here</span>
  }
}
</code></pre>
<h3 id="dispose-stage">Dispose stage</h3>
<p>In order to run application code during the <em>dispose stage</em>, the trait
<em>eu.akkamo.Disposable</em> must be extended, as in following example:</p>
<pre><code class="lang-scala"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyModule</span> <span class="hljs-keyword"><span class="hljs-keyword">extends</span></span> <span class="hljs-title">Module</span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-title">Disposable</span> {</span>
  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dispose</span>(</span>ctx: <span class="hljs-type">Context</span>): <span class="hljs-type">Res</span>[<span class="hljs-type">Unit</span>] = <span class="hljs-type">Try</span> {
    <span class="hljs-comment">// application code here</span>
  }
}
</code></pre>
<h2 id="registering-module-into-akkamo">Registering module into Akkamo</h2>
<p>When your module is ready, it must be explicitly registered into the <em>Akkamo</em>, in order to find and
run it during the application startup. As described in the beginning of the chapter, <em>Akkamo</em> uses
the <a href="https://docs.oracle.com/javase/8/docs/api/java/util/ServiceLoader.html" target="_blank">ServiceLoader</a>
mechanism. To register the module, following steps must be done:</p>
<ul>
<li>in the module <em>JAR</em> file, create directory <code>META-INF/services</code></li>
<li>in that directory, create new file called <code>eu.akkamo.Module</code></li>
<li>each line of this file should contain <em>fully qualified domain name</em> of your module
(e.g. <code>my.company.FooModule</code>), one line per module</li>
</ul>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../how-it-works/lifecycle.html" class="navigation navigation-prev " aria-label="Previous page: Akkamo Lifecycle"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../how-it-works/context.html" class="navigation navigation-next " aria-label="Next page: Akkamo Context"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="https://cdn.mathjax.org/mathjax/2.5-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-mathjax-beta/plugin.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"emphasize":{},"richquotes":{},"mathjax-beta":{},"puml":{},"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
